function smA = gaussmoth(A, nsd)% GAUSSMOOTH - smooths a 2D matrix with a 2D gaussian of standard deviation % nsd matrix elements%     smA = gaussmoth(A,nsd)% Real in should give real outwasitreal = isreal(A);% Generate Gaussian centered at middle of matrix, shift it to the edges,% normalize it to have volume 1nr = size(A,1); nc = size(A,2); nr2 = floor(nr/2); nc2 = floor(nc/2);thegau = exp(-([-nr2:-nr2+nr-1]'.^2/(2*nsd^2))*ones(1,nc) - ...          ones(nr,1)*([-nc2:-nc2+nc-1].^2/(2*nsd^2)));thegau = [thegau(:,nc2+1:nc), thegau(:,1:nc2)];thegau = [thegau(nr2+1:nr,:); thegau(1:nr2,:)];thegau = thegau/sum(sum(thegau));%figure%imagesc(thegau')% fprintf('GAUSSMOTH: thegau has volume %g.\n',sum(sum(thegau)))% Convolve circularlysmA = ifft2(fft2(A).*fft2(thegau));% Return real if input was realif wasitreal    smA = real(smA);endreturn